<ng-template #template let-modal>
  <div class="modal-container small-padding">
    <img src="/assets/img/Shape.png" (click)="modalRef.hide()" class="modal-close">
    <app-rubrics (getCurrentCategory)="selectedCategory($event)"></app-rubrics>
  </div>
</ng-template>

<div class="loading" *ngIf="loadingPostCreate">Loading..</div>

<form [formGroup]="postForm" (ngSubmit)="postForm.valid && onSubmit()" [class.hidden]="isShowPreview">
  <div class="posts-add_header">
    <span>Подать обьявление</span>
    <div class="border-bottom"></div>
  </div>
  <div class="form-gropup">
    <label>Заголовок</label>
    <input type="text" placeholder="Ваш заголовок" (focus)="focusInput()" formControlName="title">
    <app-tooltip class="tooltip-block" [settingsTooltip]="settingsTooltipInfo"></app-tooltip>
  </div>
  <div class="form-gropup">
    <label>Рубрика</label>
    <button type="button" (click)="openModal(template)" *ngIf="isShowSelectRubrics">Выбрать рубрику</button>
    <div class="rubric-array">
      <div *ngFor="let item of selectedCategories; last as isLast" class="rubric-item">
        <span>{{item}} </span> <span class="item-delimiter"> » &nbsp;</span>
      </div>
    </div>
    <button type="button" *ngIf="!isShowSelectRubrics" (click)="openModal(template)" class="small">Изменить</button>
    <img src="/assets/img/success.png" class="selected-rubric" *ngIf="!isShowSelectRubrics">
  </div>
  <div class="form-gropup strip" *ngIf="!isShowSelectRubrics">
    <app-dynamic-form-builder [fields]="getFields()" (changeData)="getCustomFields($event)"></app-dynamic-form-builder>
  </div>
  <div class="form-gropup" *ngIf="!isShowSelectRubrics">
    <app-price-custom [form]="postForm"></app-price-custom>
  </div>

  <div class="form-gropup strip">
    <label>Описание</label>
    <textarea placeholder="Ваше описание" formControlName="content"></textarea>
    <app-tooltip class="tooltip-block" [settingsTooltip]="settingsTooltipWarning"></app-tooltip>
  </div>

  <div class="form-gropup">
    <label>Фото</label>
    <div class="upload-photo-group">
      <div class="upload-photo__content">
        <div class="upload-photo main file-main" *ngIf="!photos[0]?.file?.id && !photos[0].uploadStatus?.isUploading">
          <img src="/assets/img/photo-path.png">
          <span>Титульное изображение</span>
          <div class="plus">+</div>
          <div class="upload-photo main file" (ngxf-select)="uploadFile($event, 0)" *ngIf="!photos[0]?.id"></div>
        </div>

        <div class="upload-photo main file-main" *ngIf="!photos[0]?.file?.id && photos[0].uploadStatus?.isUploading">
            <div class="line-progress" [ngStyle]="{'width': photos[0].uploadStatus?.progress + '%'}">{{photos[0].uploadStatus?.progress}}%</div>
        </div>
        <div class="upload-photo main file-main" *ngIf="photos[0]?.file?.id">
            <div [ngStyle]="{'background-image': 'url(' + env.apiUrl + photos[0]?.file?.path + ')'}" class="preview-1 upload-photo__downloaded"></div>
        </div>
      </div>

      <div class="upload-photo__min-group">
        <div class="upload-photo__min">
          <div *ngFor="let item of photos.slice(1, 7); index as index">
            <div class="upload-photo" *ngIf="!item?.file?.id && !item.uploadStatus?.isUploading">
              <div class="plus">+</div>
              <div class="upload-photo file" (ngxf-select)="uploadFile($event, index + 1)"></div>
            </div>
            <div class="upload-photo" *ngIf="item?.file?.id">
              <div class="upload-photo__downloaded" [ngStyle]="{'background-image': 'url(' + env.apiUrl + item?.file?.path + ')'}"></div>
            </div>
            <div class="upload-photo text-center" *ngIf="!item?.file?.id && item.uploadStatus?.isUploading">
              <div class="line-progress" [ngStyle]="{'width': item.uploadStatus?.progress + '%'}">{{ item.uploadStatus?.progress }}%</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="posts-add_header margin-top">
    <span>Контактные данные</span>
    <div class="border-bottom"></div>
  </div>
  <div class="form-gropup">
    <span class="descrption">Здесь выводятся Ваши контактные данные, которые будут видны покупателям.</span>
  </div>
  <div class="form-gropup">
    <label class="contact-data">Местоположение</label>
    <input  class="contact-data" type="text" placeholder="Начните писать город">
  </div>
  <div class="form-gropup">
    <label class="contact-data">Номер телефона</label>
    <input  class="contact-data" type="text" placeholder="+38 0">
  </div>
  <div class="form-gropup">
    <label class="contact-data">E-mail</label>
    <input  class="contact-data" type="text" placeholder="Ваш заголовок" disabled>
  </div>
  <div class="form-gropup">
    <label class="contact-data">Контактное лицо</label>
    <input  class="contact-data" type="text" placeholder="Введите фио">
  </div>
  <div class="posts-add_header">
    <div class="border-bottom br"></div>
  </div>
  <div class="button-group">
    <button type="button" class="btn white" (click)="togglePreview()">Предпросмотр</button>
    <button class="btn red">Опубликовать</button>
  </div>
</form>

<app-posts-add-preview *ngIf="isShowPreview"
                       [photos]="photos"
                       [form]="postForm.getRawValue()"
                       [category]="postCategory"
                       (closePreview)="togglePreview()"
></app-posts-add-preview>